function buscarAdotivos(){var a=$("#adotante_id").val();$.ajax({url:url_base+"/visitas/busca-adotivos/adotantes/"+a,method:"GET",success:function(a){var e=JSON.parse(a).adotivos;$("#adotivo_id").val(e).trigger("change"),console.log(e)},error:function(a){console.log(a.responseText)}})}function converterDataParaBase(){var a=$("#display_data").val();null!=a&&""!=a?$("#hidden_data").val(a.split("/").reverse().join("-")):$("#hidden_data").val(null)}function visitaTemMeiaHoraOuMais(a){var e=$("#tempo_total").val();if("--:--"!=e){var t=(e+":00").split(":"),o=60*+t[0]*60+60*+t[1]+ +t[2];console.log("seconds: "+o),o<3600&&($(a).val(null),$("#tempo_total").val("--:--"),showErroMessage("<p>Visita deve ter pelo menos <b>uma hora <b>ou mais</b></p>"))}}function calcularTempoTotal(){var a=$("#hora_inicio").val(),e=$("#hora_fim").val();if(a&&e){a=moment(a,"HH:mm"),e=moment(e,"HH:mm");var t=moment.duration(e.diff(a)),o=parseInt(t.asHours());o<10&&(o="0"+o);var i=parseInt(t.asMinutes())-60*o;i<10&&(i="0"+i),$("#tempo_total").val(o+":"+i)}else $("#tempo_total").val("--:--")}function isValidDate(a){var e=a.split("-"),t=new Date(e[0],e[1]-1,e[2]);return t.getFullYear()==e[0]&&t.getMonth()+1==e[1]&&t.getDate()==Number(e[2])}function validarHorarios(a){$(".error").empty();var e=$("#hora_inicio").val(),t=$("#hora_fim").val();e&&t&&(/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test($("#tempo_total").val())&&e!=t||($(a).val(null),$("#tempo_total").val("--:--"),showErroMessage("<p>Horário de <b>inicio</b> deve ser menor de horário <b>final.</b></p>")))}function validarHorarioDeVisita(a,e,t){var o=$(a).val();o&&(o<e||o>t)&&($(a).val(null),$("#tempo_total").val("--:--"),showErroMessage("<p>Horário de visitas <b> das "+e+" até "+t+".</b></p>"))}function showErroMessage(a){$(".error").append("<div class='alert alert-danger alert-dismissible fade in' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span></button>"+a+"</div>")}function clearErros(){$(".error").empty()}$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(function(){function a(a){if(t(),$(".modal-title").html(a.title),$('.modal-footer button:not(".btn-default")').remove(),$("#title").val(a.event?a.event.title:""),a.event)o="0"===(o=a.event.date.split(" ")[1].slice(0,-3)).charAt(0)?o.slice(1):o;else var e=new Date,o=e.getHours()+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());$("#adotante_id").val(a.event?a.event.adotante_id:null);var i=a.event?a.event.adotivo_id:null;$("#adotivo_id").val(i).trigger("change"),$("#time").val(o),$("#description").val(a.event?a.event.description:""),$("#hora_inicio").val(a.event?a.event.hora_inicio:""),$("#hora_fim").val(a.event?a.event.hora_fim:""),$("#hidden_data").val(a.event?a.event.date:""),calcularTempoTotal(),a.event?($("#display_data").prop("disabled",!1),$("#observacoes_div").show()):$("#adotante_id").prop("disabled",!1),$("#display_data").val(a.event?a.event.dia_formatado:""),$("#hidden_data").val(a.event?a.event.dia_base:""),$.each(a.buttons,function(a,e){$(".modal-footer").prepend('<button type="button" id="'+e.id+'" class="btn '+e.css+'">'+e.label+"</button>")}),$(".modal").modal("show")}function e(a){clearErros();var e=0;$.each(a,function(a,t){""==$.trim($("#"+t).val())&&(e++,o(t))});var t=$("#hidden_data").val();return s(t)||(showErroMessage("<p> A data informada <b>é antes de hoje!</b></p>"),e++),isValidDate(t)||(showErroMessage("<p> A data informada <b>é inválida!</b></p>"),e++),!e}function t(){$("#display_data").val(null),$("#display_data").prop("disabled",!0),$("#hidden_data").val(null),$("#adotivo_id").val("").trigger("change"),$("#adotante_id").val(null),$("#adotante_id").prop("disabled",!0),$("#hora_inicio").val(null),$("#hora_fim").val(null),$("#observacoes").val(null),$("#tempo_total").val("--:--"),$("#observacoes_div").hide(),$(".error").empty()}function o(a){showErroMessage("<p>Por favor preencher o campo <b>"+n(a)+"</b></p>")}function i(a){var e=new Date,t=new Date(a).getTime()-e.getTime();return Math.ceil(t/864e5)}function n(a){var e;switch(a){case"adotante_id":e="adotante";break;case"display_data":e="dia";break;case"hora_inicio":e="hora inicial";break;case"hora_fim":e="hora final";break;case"observacoes":e="motivo"}return e}function s(a){return(new Date).format("Y-m-d")<=a}var r,l;$("#color").colorpicker(),$("#time").timepicker({minuteStep:5,showInputs:!1,disableFocus:!0,showMeridian:!1}),$("#calendar").fullCalendar({eventLimit:!0,navLinks:!0,timeFormat:"H(:mm)",handleWindowResize:!1,header:{left:"prev, next, today",center:"title",right:"month, basicWeek, basicDay"},events:url_base+"/visitas/listar",dayClick:function(e,t,o){r=e.format(),clickedDate=e.format("Y-MM-DD"),s(clickedDate)?i(clickedDate)<=60?(a({buttons:{add:{id:"add-event",css:"btn btn-success",label:"Agendar"}},title:"Agendar visita para o dia: "+e.format("DD/MM/Y")}),$("#display_data").val(e.format("DD/MM/Y")),$("#hidden_data").val(e.format("Y-MM-DD"))):swal("Data inválida","Só é possível agendar visita em uma data que seja no máximo daqui 60 dias!","error"):swal("Data inválida","Impossível agendar visita em uma data antes de hoje!","error")},eventMouseover:function(a,e,t){var o='<div class="event-tooltip">'+a.description+"</div>";$("body").append(o),$(this).mouseover(function(a){$(this).css("z-index",1e4),$(".event-tooltip").fadeIn("500"),$(".event-tooltip").fadeTo("10",1.9)}).mousemove(function(a){$(".event-tooltip").css("top",a.pageY+10),$(".event-tooltip").css("left",a.pageX+20)})},eventMouseout:function(a,e){$(this).css("z-index",8),$(".event-tooltip").remove()},eventClick:function(e,t,o){l=e,a({buttons:{delete:{id:"delete-event",css:"btn btn-danger",label:"Cancelar Visita"},update:{id:"update-event",css:"btn-success",label:"Reagendar",onchange:"clearErros()"}},title:"Editar visita do dia "+e.dia_formatado,event:e})}}),$(".modal").on("click","#add-event",function(a){e(["adotante_id","hidden_data","hora_inicio","hora_fim"])&&$.ajax({url:url_base+"/visitas",method:"POST",data:{adotante_id:$("#adotante_id").val(),hora_inicio:$("#hora_inicio").val(),hora_fim:$("#hora_fim").val(),status:"agendado",dia:r},success:function(a){$(".modal").modal("hide"),t(),$("#calendar").fullCalendar("refetchEvents"),JSON.parse(a).status?swal("Agendado",JSON.parse(a).message,"success"):swal("Não Agendado",JSON.parse(a).message,"error"),console.log(a)},error:function(a){console.log(a.responseText)}})}),$(".modal").on("click","#update-event",function(a){e(["observacoes","hidden_data","hora_inicio","hora_fim"])&&$.ajax({url:url_base+"/visitas/"+l._id,method:"PUT",data:{hora_inicio:$("#hora_inicio").val(),hora_fim:$("#hora_fim").val(),status:"reagendado",dia:$("#hidden_data").val(),observacoes:$("#observacoes").val()},success:function(a){$(".modal").modal("hide"),$("#calendar").fullCalendar("refetchEvents"),JSON.parse(a).status?swal("Reagendo",JSON.parse(a).message,"success"):swal("Não Reagendo",JSON.parse(a).message,"error"),console.log(a)},error:function(a){console.log(a.responseText)}})}),$(".modal").on("click","#delete-event",function(a){e(["observacoes"])&&$.ajax({url:url_base+"/visitas/"+l._id,method:"DELETE",data:{status:"cancelado",observacoes:$("#observacoes").val()},success:function(a){$(".modal").modal("hide"),$("#calendar").fullCalendar("refetchEvents"),swal("Cancelada",JSON.parse(a).message,"success"),console.log(a)},error:function(a){console.log(a.responseText)}})})})}),$("#adotivo_id").select2({placeholder:"--",multiple:!0});